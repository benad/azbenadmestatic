<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
                <title>IPC between services in the JVM: Part 4 of 4 - Benad's Web Site</title>
		<meta name="description" content=""/>
		<meta name="viewport" content="width=device-width"/>
		<link rel="stylesheet" href="/css/bootstrap.css"/>
		<link rel="stylesheet" href="/css/bootstrap-responsive.css"/>
		<link rel="stylesheet" href="/css/main.css"/>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="//feeds.feedburner.com/benad">
		<script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	</head>
	<body>
            <!--[if lt IE 7]>
		<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/"> upgrade your browser</a> to improve your experience.</p>
                <![endif]-->
		<div class="container">

<div class="row">
        <h1 class="title">Benad's Web Site</h1>
        <h2 class="pageheader">IPC between services in the JVM: Part 4 of 4</h2>
</div>
<div class="row">
        <div class="span2 pull-right sidebar">
                <p><a href="/index.html">Home</a></p>
                <p><a href="/blog">Blog</a></p>
                <p><a href="/me.html">About Me</a></p>
                <p><a href="/meta.html">About This Site</a></p>
                <p><a href="/articles.html">Articles</a></p>
                <p><a href="/links.html">Links</a></p>
        </div>

        <div class="span8 offset2">
                <div class="posterous_autopost"><p><strong>Message Queues</strong></p>  <p>The approach I settled for is one that uses message queues between the OSGi services. This is roughly the equivalent of inter-process message queues in UNIX System V or file sockets in BSD.</p>  <p>When the messages themselves are immutable objects, this avoids almost all potential race conditions and deadlocks caused by shared objects. Even when using non-blocking queues, the simple matter of copying/moving large amount of objects (or, worse, using any form of object serialization) makes this much slower than using shared memory. If the message objects are big, then it may be better to avoid serialization and take the risk of having two services refer to the same object at the same time.</p>  <p>As for what library to use to implement those queues, there are many high-performance libraries to choose from, though few of these have a way of running in &ldquo;embedded mode&rdquo; within the same JVM that runs the OSGi container.</p>  <p>There&rsquo;s a way of running <a href="https://mq.dev.java.net/">Open Message Queues for Java</a>, which can <a href="https://mq.dev.java.net/4.4-content/embedded-example.html">run in embedded mode</a>, but it&rsquo;s quite big, complex and &ldquo;Enterprise-y&rdquo;. There&rsquo;s also <a href="http://github.com/robey/kestrel">Kestrel</a>, a minimalist small implementation, and can also <a href="http://github.com/robey/kestrel/blob/master/docs/guide.md">run in embedded mode</a>, but then it needs <a href="http://www.scala-lang.org/">Scala</a> which I won&rsquo;t even try running within an OSGi module.</p>  <p>But these library are <em>network</em>-oriented, which not only makes their implementation more complex but also slower in the special case when all the messages remains in the same JVM. So, in the end, I just used the Java 5 built-in <code>java.util.concurrent.BlockingQueue</code> and made my own simple message passing interface around it.</p></div>

                <p>Published on August 17, 2010 at 14:03 EDT</p>
                <p>Older post: <a href="https://benad.me/blog/2010/7/30/mobileme-member-since-10-years">MobileMe: Member Since 10 Years!</a></p>
                <p>Newer post: <a href="https://benad.me/blog/2010/8/27/anti-social-news-aggregation">Anti-Social News Aggregation</a></p>
        </div>
        <div id="disqus_thread" class="span8 offset2"></div>
</div>
			<footer>
				<hr/>
				<p>Benad's Web Site by Benoit Nadeau is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/2.5/ca/">Creative Commons Attribution-Share Alike 2.5 Canada License</a></p>
			</footer>
		</div>
		<script src="/js/vendor/jquery-1.9.1.min.js"></script>
		<script src="/js/vendor/bootstrap.min.js"></script>
		<script src="/js/main.js"></script>
	</body>
</html>

