<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
                <title>IPC between services in the JVM: Part 1 of 4 - Benad's Web Site</title>
		<meta name="description" content=""/>
		<meta name="viewport" content="width=device-width"/>
		<link rel="stylesheet" href="/css/bootstrap.css"/>
		<link rel="stylesheet" href="/css/bootstrap-responsive.css"/>
		<link rel="stylesheet" href="/css/main.css"/>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="//feeds.feedburner.com/benad">
		<script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	</head>
	<body>
            <!--[if lt IE 7]>
		<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/"> upgrade your browser</a> to improve your experience.</p>
                <![endif]-->
		<div class="container">

<div class="row">
        <h1 class="title">Benad's Web Site</h1>
        <h2 class="pageheader">IPC between services in the JVM: Part 1 of 4</h2>
</div>
<div class="row">
        <div class="span2 pull-right sidebar">
                <p><a href="/index.html">Home</a></p>
                <p><a href="/blog">Blog</a></p>
                <p><a href="/me.html">About Me</a></p>
                <p><a href="/meta.html">About This Site</a></p>
                <p><a href="/articles.html">Articles</a></p>
                <p><a href="/links.html">Links</a></p>
        </div>

        <div class="span8 offset2">
                <div class="posterous_autopost"><h3>Learning About OSGi</h3>  <p>When I started learning about <a href="http://www.osgi.org/">OSGi</a> in late 2008, it felt quite simple, mostly due to the <a href="http://www.osgi.org/Release4/Download">specification</a>&rsquo;s clarity and design. But a year ago I thought that designing code for OSGi might give me the greatest challenge I&rsquo;ve ever had with software design. Or so I thought until I realized those design &ldquo;challenges&rdquo; were solved decades ago.</p>  <p>Here are few examples of those &ldquo;challenges&rdquo;. First, I noticed that most examples I&rsquo;ve seen for a service bundle and its client are separated by an API bundle of some kind. Makes sense, I thought, as using an interface between the provider of a service and its user makes it possible to replace the service implementation. But, actually, those API bundles were not made for that at all. The class instances passed from the service to its client, through whatever interface, must not be created by the classloader of the service&rsquo;s package, otherwise if the service is unloaded its classloader will &ldquo;leak&rdquo; in memory until all of its created object instances are garbage-collected. Since the instance&rsquo;s package defines what bundle&rsquo;s classloader to use to create it, then defining those &ldquo;interface beans&rdquo; in an API bundle prevents that &ldquo;classloader leak&rdquo; problem.</p>  <p>Second, you shouldn&rsquo;t be using <code>BundleContext.getServiceReferences(String, String)</code>, unless you&rsquo;re planning on calling <code>BundleContext.ungetService(ServiceReference)</code> on all of them right away. Actually, if you want to &ldquo;bind&rdquo; a bundle to some service by getting its <code>ServiceReference</code>, you should do so outside of <code>BundleActivator.start()</code>, because it &ldquo;must complete and return to its caller in a timely manner&rdquo; and you can&rsquo;t block to wait for another service to start. Actually, you should use a <code>ServiceListener</code> and listen for service registration asynchronously, so if you <em>really</em> want to &ldquo;block&rdquo; in <code>start()</code>, instead start a thread that gets awakened by <code>ServiceListener</code> events.</p>  <p>That second point introduced me to a new perspective on how lifecycle initialization in IoC and modular systems <em>actually</em> imply.</p>  </div>

                <p>Published on June 3, 2010 at 13:21 EDT</p>
                <p>Older post: <a href="https://benad.me/blog/2010/5/29/markdown-test">Markdown Test</a></p>
                <p>Newer post: <a href="https://benad.me/blog/2010/7/1/our-national-moving-day">Our National Moving Day</a></p>
        </div>
        <div id="disqus_thread" class="span8 offset2"></div>
</div>
			<footer>
				<hr/>
				<p>Benad's Web Site by Benoit Nadeau is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/2.5/ca/">Creative Commons Attribution-Share Alike 2.5 Canada License</a></p>
			</footer>
		</div>
		<script src="/js/vendor/jquery-1.9.1.min.js"></script>
		<script src="/js/vendor/bootstrap.min.js"></script>
		<script src="/js/main.js"></script>
	</body>
</html>

