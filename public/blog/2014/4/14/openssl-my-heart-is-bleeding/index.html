<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
                <title>OpenSSL: My Heart is Bleeding - Benad's Web Site</title>
		<meta name="description" content=""/>
		<meta name="viewport" content="width=device-width"/>
		<link rel="stylesheet" href="/css/bootstrap.css"/>
		<link rel="stylesheet" href="/css/bootstrap-responsive.css"/>
		<link rel="stylesheet" href="/css/main.css"/>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="//feeds.feedburner.com/benad">
		<script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	</head>
	<body>
            <!--[if lt IE 7]>
		<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/"> upgrade your browser</a> to improve your experience.</p>
                <![endif]-->
		<div class="container">

<div class="row">
        <h1 class="title">Benad's Web Site</h1>
        <h2 class="pageheader">OpenSSL: My Heart is Bleeding</h2>
</div>
<div class="row">
        <div class="span2 pull-right sidebar">
                <p><a href="//benad.me/index.html">Home</a></p>
                <p><a href="/blog">Blog</a></p>
                <p><a href="//benad.me/me.html">About Me</a></p>
                <p><a href="//benad.me/meta.html">About This Site</a></p>
                <p><a href="//benad.me/articles.html">Articles</a></p>
                <p><a href="//benad.me/links.html">Links</a></p>
        </div>

        <div class="span8 offset2">
                <p>After a week, I think I can comfortably explain what happened with this "heartbleed" OpenSSL bug. Now, everybody make mistakes. Especially programmers. Especially me. But at least my errors didn't create a major security hole in 20% of the Internet. Let's review some basic tenets of Software Engineering:</p>

<ol>
<li>All code (of minimal size and complexity) has bugs. Less code and complexity (and functionality) means less bugs.</li>
<li>Software should be made resilliant against errors. If it can't, it should at least halt (crash).</li>
<li>Software should be designed for Humans, both the code and user interface.</li>
</ol>

<p>Out of hubris, excess and arrogance, the OpenSSL developers managed to do the opposite of all of these tenets. To <a href="http://article.gmane.org/gmane.os.openbsd.misc/211963">quote Theo de Raadt</a>:</p>

<blockquote>
  <p>OpenSSL is not developed by a responsible team.</p>
</blockquote>

<p>Why? Let's do some investigation.</p>

<p>First, <a href="http://www.robin-seggelmann.de/">Robin Seggelmann</a> had this idea to add a <a href="http://tools.ietf.org/html/draft-ietf-tls-dtls-heartbeat-00">completely unnecessary "heartbeat" feature to TLS</a>.  Looking at the protocol design alone, the simple fact that the size of the payload exists in two different places (TLS itself and Heartbeat) is pretty bad and begs for a security hole. Anyway, tenet one.</p>

<p>Still, Seggelmann went ahead and <a href="https://github.com/openssl/openssl/commit/4817504d069b4c5082161b02a22116ad75f822b1">sent working code a year later</a>, on December 31st, at 11:59 PM, the best time for a code review. Of course, the code is filled with non-descriptive variable names which hide the error in plain sight during the ineffective code review, but given the <a href="https://www.peereboom.us/assl/assl/html/openssl.html">poor quality of the OpenSSL code</a>, they find this acceptable. That's tenet three.</p>

<p>At this point, you may ask: "Shouldn't most modern <code>malloc</code> implementations minimally protect software against buffer overflows and overreads?" If you did, you are correct. But then, years ago, OpenSSL implemented their <a href="http://www.tedunangst.com/flak/post/heartbleed-vs-mallocconf">own memory allocation scheme</a>. If you try to revert that back to plain <code>malloc</code>, OpenSSL doesn't work anymore because its code has bugs that <a href="http://www.tedunangst.com/flak/post/analysis-of-openssl-freelist-reuse">depends on memory blocks being recycled in LIFO fashion</a>. That's tenet two.</p>

<p>The result is bad, and very, very real. In Canada, <a href="http://www.cbc.ca/news/business/heartbleed-bug-900-sins-stolen-from-revenue-canada-1.2609192">nearly a thousand Social Insurance Numbers were leaked</a>. And that doesn't count or even start to imagine how many private keys and information leaked like that over the past two years.</p>

<p>By the way, this kind of mess have been my experience with cryptographic software. The usability problem with cryptography isn't just for end users, but also the code itself. Using single-letter variables in a mathematical context where each variable is described at length may be acceptable, but meaningless variable <em>letters</em> without comments in code isn't. While I don't mind much about such "math code" in data compression, for security this makes the code less likely to be secure. Basically, everybody think that being smart is sufficient for writing good code, so of course they would be offended if a software engineer would recommend writing the code from their specs instead of letting them do it themselves. No wonder the worst code always comes from university "careerists".</p>

<p>Personally, I'd stop using OpenSSL as soon as possible.</p>

                <p>Published on April 14, 2014 at 21:29 EDT</p>
                <p>Older post: <a href="https://benad.me/blog/2014/4/2/a-week-with-android">A Week with Android</a></p>
                <p>Newer post: <a href="https://benad.me/blog/2014/5/26/ios-and-android-development-tools">iOS and Android Development Tools</a></p>
        </div>
        <div id="disqus_thread" class="span8 offset2"></div>
</div>
			<footer>
				<hr/>
				<p>Benad's Web Site by Benoit Nadeau is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/2.5/ca/">Creative Commons Attribution-Share Alike 2.5 Canada License</a></p>
			</footer>
		</div>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
		<script src="/js/vendor/bootstrap.min.js"></script>
		<script src="/js/main.js"></script>
		<script>
		var _gaq=[['_setAccount','UA-6588628-1'],['_trackPageview']];
		(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
		g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
		s.parentNode.insertBefore(g,s)}(document,'script'));
		</script>
		<script>
var disqus_config = function () {
this.page.url = window.location.protocol + "//" + window.location.hostname + "/blog/2014/4/14/openssl-my-heart-is-bleeding";
this.page.identifier = "https://benad.me/blog/2014/4/14/openssl-my-heart-is-bleeding";
this.page.title = "OpenSSL: My Heart is Bleeding";
};
(function() {
if (window.location.hostname != 'benad.me')
    return;
var d = document, s = d.createElement('script');
var disqus_shortname = "benadmeblog";
s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</body>
</html>

